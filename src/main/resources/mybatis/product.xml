<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="product"> 

<select id="list" resultType="Product">
	SELECT pNo, cNo, pCode, pName, pImg1 
	FROM tbl_product 
	ORDER BY pNo DESC 
	LIMIT 16
</select>

<select id="product" resultType="Product">
	SELECT *, (SELECT salePrice 
                 FROM tbl_sale_product 
                 WHERE tbl_product.pNo = tbl_sale_product.pNo
                 ORDER BY saleEnd DESC
                 LIMIT 1) recentPrice,
                 					(SELECT salePrice 
										FROM tbl_sale_product 
										WHERE tbl_product.pNo = tbl_sale_product.pNo AND progress = 4
										ORDER BY salePrice
										LIMIT 1) immediatePurchacePrice,
																	(SELECT desiredPrice 
																		FROM tbl_hope_purchase 
																		WHERE tbl_product.pNo = tbl_hope_purchase.pNo
																		ORDER BY desiredPrice DESC
																		LIMIT 1) immediateSellingPrice
                 					    
     FROM tbl_product WHERE pNo = ${pNo}
</select>

<select id="chart" resultType="Chart">
	SELECT grade, date_format(saleEnd, "%Y-%m-%d") saleEnd, salePrice 
	FROM tbl_sale_product 
	WHERE progress IN (6, 7, 8) AND pNo = ${pNo}
	ORDER BY saleEnd;
</select>



</mapper>